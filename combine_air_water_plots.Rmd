---
title: "combine_air_water_plots"
author: "Catarina Pien"
date: '2023-06-05'
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(sf)
library(dplyr)
library(ggplot2)
```

Read in data; Project
```{r}
my_crs<-26910
cities <- st_read(here::here("shapefiles/SBDS city boundaries/SBDS city boundaries.shp"))
cities_sf <- st_transform(cities, crs = my_crs)

# Metropolitan areas (via Census Designated Places)
# cities <- places(state = "CA", year = 2018, cb = TRUE)%>%
#   filter(NAME %in% c("Isleton", "Pittsburg","Sacramento", "Stockton", "West Sacramento" ))%>%
#   select(geometry)%>%
#   st_transform(crs=my_crs) 
# cities_sf <- data.frame(City =  c("Stockton","Sacramento",  "Isleton", "Pittsburg" ,"West Sacramento" )) %>%
#   cbind(cities) %>%
#   st_as_sf() %>%
#   mutate(City = factor(City))

latlons <- read.csv("https://portal.edirepository.org/nis/dataviewer?packageid=edi.591.2&entityid=a059f5eea4f8500fe1a43566451ec593")
sta_locations_sf <- latlons %>%
  filter(Station %in% stations) %>%
  st_as_sf(coords = c("Longitude", "Latitude"),
           crs = 4326)
sta_locations_26910 <- st_transform(sta_locations_sf, crs = my_crs) %>%
 mutate(StationName = stringr::str_to_title(StationName)) %>%
  mutate(StationName = replace(StationName, StationName == "Vernalis (Usbr)", "Vernalis"))

WW_Delta <- st_transform(WW_Delta, crs = my_crs)
```

Make map
```{r}
(map <- ggplot() +
      geom_sf(data = WW_Delta %>% filter(!HNAME%in% c("SAN FRANCISCO BAY" , "SAN PABLO BAY")), color = "gray85", fill = "gray80") + 
  geom_sf(data = cities_sf, aes(fill = major_city),  alpha = 0.3 ,inherit.aes = FALSE) +
 # geom_sf_label(data = cities_sf, aes(label = City), 
 #                nudge_x = c(0.3, 0.5, 0.1, 0.1, 0.1), 
 #                nudge_y = c(-0.05), inherit.aes = FALSE) +
  geom_sf_label(data = cities_sf, aes(label = major_city),
                hjust = c(0.7, -0.5, 0, 0, 1), 
                vjust = c(-0.8, 1.3, 0, -0.5, 2),
                colour = "black",  size = 3.5, inherit.aes = FALSE)+
  geom_sf(data = sta_locations_26910, aes(color = StationName), size = 3, inherit.aes = FALSE) +
  scale_x_continuous(limits = c(570000, 671000)) +
  scale_color_viridis_d(option = "turbo") + 
  scale_fill_viridis_d()+
  labs(color = "Water temperature\nStations") +
  guides(fill = FALSE)+
  theme_classic() +
  theme(axis.title = element_blank()))
```

Write map
```{r}
png("figs/map_temperature_stations.png", height = 7, width = 8, units = "in", pointsize = 9,
    res=300)
map
dev.off()
```




